apiVersion: v1
kind: Service
metadata:
  name: grpc-echo
  labels:
    app: grpc-echo
spec:
  # ---- gRPC / metrics の Service type と port を Values から読む（なければデフォルト） ----
  {{- $svc := .Values.service | default dict }}
  {{- $grpc := $svc.grpc | default (dict "type" "ClusterIP" "port" 50051) }}
  {{- $metrics := $svc.metrics | default (dict "type" "ClusterIP" "port" 9464) }}

  type: {{ $grpc.type }}
  selector:
    app: grpc-echo
  ports:
    - name: grpc
      port: {{ $grpc.port }}
      targetPort: 50051
    - name: metrics
      port: {{ $metrics.port }}
      targetPort: 9464
